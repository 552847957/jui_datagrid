/**
 * jquery plugin which displays data in tabular format (datagrid)
 * Requires jquery, jquery-ui, jquery-ui themes
 * It uses jui_dropdown and jui_pagination plugin
 * Copyright 2012 Christos Pontikis http://pontikis.net
 * Project page https://github.com/pontikis/jui_datagrid
 * UPCOMING Release: 1.00 (?? Nov 2012)
 * License MIT
 * Minified using Online YUI Compressor http://www.refresh-sf.com/yui/
 */
"use strict";(function(i){var c="jui_datagrid";var k="jui_datagrid_status";var r={init:function(s){var t=this;return this.each(function(){var w=t.data(c);if(typeof(w)==="undefined"){var z=t.jui_datagrid("getDefaults");w=i.extend({},z,s)}else{w=i.extend({},w,s)}t.data(c,w);if(typeof t.data(k)==="undefined"){t.data(k,{});t.data(k)["a_selected_ids"]=[];t.data(k)["count_selected_ids"]=0}if(w.rowSelectionMode=="single"||w.rowSelectionMode==false){t.data(k)["a_selected_ids"]=[];t.data(k)["count_selected_ids"]=0}var A=t.attr("id");t.unbind("onCellClick").bind("onCellClick",w.onCellClick);t.unbind("onRowClick").bind("onRowClick",w.onRowClick);t.unbind("onDelete").bind("onDelete",w.onDelete);t.unbind("onDisplay").bind("onDisplay",w.onDisplay);var x,E,F,B,y,C;x=p(w.header_id_prefix,A);E=p(w.datagrid_id_prefix,A);F=p(w.tools_id_prefix,A);B=p(w.pagination_id_prefix,A);y=p(w.pref_dialog_id_prefix,A);if(!t.data(k)["initialize"]){C='<div id="'+x+'">'+w.title+"</div>";C+='<div id="'+E+'"></div>';C+='<div id="'+F+'"></div>';C+='<div id="'+B+'"></div>';C+='<div id="'+y+'"></div>';t.html(C);t.data(k)["initialize"]=true}var H=i("#"+x);var v=i("#"+E);var G=i("#"+F);var u=i("#"+B);var D=i("#"+y);t.removeClass().addClass(w.containerClass);if(typeof w.title==="undefined"){H.hide()}else{H.show().text(w.title).removeClass().addClass(w.headerClass)}v.removeClass().addClass(w.datagridClass);G.removeClass().addClass(w.toolsClass);u.removeClass().addClass(w.paginationClass);i.ajax({type:"POST",url:w.ajaxFetchDataURL,data:{page_num:w.pageNum,rows_per_page:w.rowsPerPage},success:function(ab){var O=i.parseJSON(ab);var Q=O.row_primary_key;var M=O.total_rows;var U=O.page_data;if(M==0){q(A);g(A,M)}else{a(A,M,U,Q);n(A);l(A);g(A,M);d(A,M)}var W,L,P;if(M>0){var R=p(t.jui_datagrid("getOption","table_id_prefix"),A);var K=i("#"+R);var T,S;W="tbody tr td";K.off("click",W).on("click",W,function(){T=i(this).index()+1;S=i(this).parent("tr").index()+1;t.triggerHandler("onCellClick",{col:T,row:S})});W="tbody tr";K.off("click",W).on("click",W,function(){if(w.rowSelectionMode!=false){var ad=(R+"_tr_").length;var ae=parseInt(i(this).attr("id").substr(ad));if(w.rowSelectionMode=="single"){t.data(k)["a_selected_ids"]=[];t.data(k)["count_selected_ids"]=0;K.find("td").removeClass(w.selectedTrTdClass)}var ac=i.inArray(ae,t.data(k)["a_selected_ids"]);if(ac>-1){t.data(k)["a_selected_ids"].splice(ac,1);t.data(k)["count_selected_ids"]-=1;i(this).children("td").removeClass(w.selectedTrTdClass)}else{t.data(k)["a_selected_ids"].push(ae);t.data(k)["count_selected_ids"]+=1;i(this).children("td").addClass(w.selectedTrTdClass)}var af=t.data(k)["count_selected_ids"];L=p(t.jui_datagrid("getOption","tools_id_prefix"),A);P=L+"_drop_select";i("#"+P+"_launcher").button({label:rsc_jui_dg.tb_selected_label+": "+af})}t.triggerHandler("onRowClick",{})})}if(w.showPrefButton){W="#"+p(w.tools_id_prefix,A)+"_pref";t.off("click",W).on("click",W,function(){f(A,y);var ac=p(w.pref_tabs_id_prefix,A);i("#"+ac).tabs({create:function(ad,ae){i("#"+ac+" li a").blur()},activate:function(ad,ae){i("#"+ac+" li a").blur()}})});var Y,J,X;Y=["_btn_select","_btn_refresh","_btn_delete","_btn_print","_btn_export","_btn_filters"];J=["showSelectButtons","showRefreshButton","showDeleteButton","showPrintButton","showExportButton","showFiltersButton"];for(X in Y){h(t,D,"#"+y+Y[X],J[X])}Y=["_slider","_goto_page","_rows_per_page","_rows_info","_nav_buttons"];J=["useSlider","showGoToPage","showRowsPerPage","showRowsInfo","showNavButtons"];for(X in Y){e(t,D,"#"+y+Y[X],J[X])}}if(w.showSelectButtons&&w.rowSelectionMode=="multiple"){L=p(t.jui_datagrid("getOption","tools_id_prefix"),A);P=L+"_drop_select";i("#"+P).jui_dropdown({onSelect:function(ac,ad){console.log(ad.index)}})}if(w.showRefreshButton){W="#"+p(w.tools_id_prefix,A)+"_refresh";t.off("click",W).on("click",W,function(){i("#"+A).jui_datagrid("refresh")})}if(w.showDeleteButton){W="#"+p(w.tools_id_prefix,A)+"_delete";t.off("click",W).on("click",W,function(){t.triggerHandler("onDelete")})}if(M>0){var V=w.pageNum;var N=w.rowsPerPage;var I=w.maxRowsPerPage;var aa=i("#"+B);var Z=t.jui_datagrid("getPaginationOption","showRowsInfo");aa.jui_pagination({onSetRowsPerPage:function(ac,ad){if(isNaN(ad)||ad<=0){t.jui_datagrid("refresh")}else{I=parseInt(I);if(I>0){if(ad>I){ad=I}}t.jui_datagrid({pageNum:1,rowsPerPage:ad})}},onChangePage:function(ad,ac){t.jui_datagrid({pageNum:ac})},onDisplay:function(){if(Z){var ac=((V-1)*N)+1;var ad=Math.min(ac+N-1,M);var ae=ac+"-"+ad+" "+rsc_jui_dg.rows_info_of+" "+M+" "+rsc_jui_dg.rows_info_records;i(this).jui_pagination("setRowsInfo",ae)}}})}t.triggerHandler("onDisplay")}})})},getDefaults:function(){return{pageNum:1,rowsPerPage:10,maxRowsPerPage:100,rowSelectionMode:"multiple",showPrefButton:true,showSelectButtons:true,showRefreshButton:true,showDeleteButton:true,showPrintButton:true,showExportButton:true,showFiltersButton:true,showPrefButtonText:false,showRefreshButtonText:false,showDeleteButtonText:true,showPrintButtonText:false,showExportButtonText:false,showFiltersButtonText:false,dropdownSelectOptions:{menuClass:"dropdown_select_menu",launcherClass:"dropdown_select_launcher"},usePagination:true,paginationOptions:{visiblePageLinks:5,useSlider:true,showGoToPage:false,showRowsPerPage:true,showRowsInfo:true,showPreferences:false,disableSelectionNavPane:true},containerClass:"grid_container ui-state-default ui-corner-all",headerClass:"grid_geader ui-widget-header ui-corner-top",datagridClass:"grid_data",toolsClass:"grid_tools ui-state-default ui-corner-all",paginationClass:"grid_pagination",applyUIGridStyle:true,tableClass:"grid_table",trHoverClass:"ui-state-hover trhover",thClass:"ui-state-default",tdClass:"ui-widget-content",selectedTrTdClass:"ui-state-highlight",tbButtonContainer:"tbBtnContainer",tbPrefIconClass:"ui-icon-gear",tbRefreshIconClass:"ui-icon-refresh",tbDeleteIconClass:"ui-icon-trash",tbPrintIconClass:"ui-icon-print",tbExportIconClass:"ui-icon-extlink",tbFiltersIconClass:"ui-icon-search",datagrid_id_prefix:"dg_",header_id_prefix:"header_",table_id_prefix:"tbl_",tools_id_prefix:"tools_",pagination_id_prefix:"pag_",pref_dialog_id_prefix:"pref_dlg_",pref_tabs_id_prefix:"pref_tabs_",onCellClick:function(){},onRowClick:function(){},onDelete:function(){},onDisplay:function(){}}},getOption:function(s){var t=this;return t.data(c)[s]},getAllOptions:function(){var s=this;return s.data(c)},setOption:function(s,v,u){var t=this;t.data(c)[s]=v;if(u){t.jui_datagrid("init")}},refresh:function(){var s=this;s.jui_datagrid()},destroy:function(){return i(this).each(function(){var u=i(this);var t=u.attr("id");var s=u.jui_datagrid("getOption","pagination_id_prefix")+t;i("#"+s).removeData();u.removeData()})},setGridStyle:function(t,u,x,s){var w=this;var v="#"+p(i(w).jui_datagrid("getOption","table_id_prefix"),w.attr("id"));i(v).removeClass().addClass(t);if(u!=""){i(v).on("mouseover mouseout","tbody tr",function(y){i(this).children().toggleClass(u,y.type=="mouseover")})}i(v).find("th").removeClass().addClass(x);i(v).find("td").removeClass().addClass(s)},getPaginationOption:function(u){var t=this.attr("id");var s=i("#"+t).jui_datagrid("getOption","pagination_id_prefix")+t;return i("#"+s).jui_pagination("getOption",u)},getAllPaginationOptions:function(){var t=this.attr("id");var s=i("#"+t).jui_datagrid("getOption","pagination_id_prefix")+t;return i("#"+s).jui_pagination("getAllOptions")}};var p=function(t,s){return t+s};var b=function(s){return(i("#"+s).length===0?false:true)};var o=function(s,t){if(!b(s)){return false}else{return(typeof i("#"+s).data(t)==="object"?true:false)}};var e=function(u,t,s,v){t.off("click",s).on("click",s,function(){var w={};w[v]=i(this).is(":checked");u.jui_datagrid({paginationOptions:w})})};var h=function(u,t,s,v){t.off("click",s).on("click",s,function(){var w={};w[v]=i(this).is(":checked");u.jui_datagrid(w)})};var m=function(s,t){var u;u="<li>";u+='<input type="checkbox" id="'+s+'" /><label for="'+s+'">'+t+"</label>";u+="</li>";return u};var j=function(z){var t=i("#"+z);var x=t.jui_datagrid("getOption","pref_dialog_id_prefix");var v=p(x,z);x=t.jui_datagrid("getOption","pref_tabs_id_prefix");var A=p(x,z);var u="";u+='<div id="'+A+'">';u+="<ul>";u+='<li><a href="#'+A+'_grid">'+rsc_jui_dg.pref_tab_grid+"</a></li>";u+='<li><a href="#'+A+'_tools">'+rsc_jui_dg.pref_tab_tools+"</a></li>";u+='<li><a href="#'+A+'_nav">'+rsc_jui_dg.pref_tab_nav+"</a></li>";u+="</ul>";u+='<div id="'+A+'_grid">';u+="Under construction 1";u+="</div>";u+='<div id="'+A+'_tools">';u+='<ul style="list-style-type: none;">';u+=m(v+"_btn_select",rsc_jui_dg.pref_show_select);u+=m(v+"_btn_refresh",rsc_jui_dg.pref_show_refresh);u+=m(v+"_btn_delete",rsc_jui_dg.pref_show_delete);u+=m(v+"_btn_print",rsc_jui_dg.pref_show_print);u+=m(v+"_btn_export",rsc_jui_dg.pref_show_export);u+=m(v+"_btn_filters",rsc_jui_dg.pref_show_filters);u+="</ul>";u+="</div>";u+='<div id="'+A+'_nav">';u+='<ul style="list-style-type: none;">';u+=m(v+"_slider",rsc_jui_pag.pref_show_slider);u+=m(v+"_goto_page",rsc_jui_pag.pref_show_goto_page);u+=m(v+"_rows_per_page",rsc_jui_pag.pref_show_rows_per_page);u+=m(v+"_rows_info",rsc_jui_pag.pref_show_rows_info);u+=m(v+"_nav_buttons",rsc_jui_pag.pref_show_nav_buttons);u+="</ul>";u+="</div>";u+="</div>";i("#"+v).html(u);var s,y,w;s=["_btn_select","_btn_refresh","_btn_delete","_btn_print","_btn_export","_btn_filters"];y=["showSelectButtons","showRefreshButton","showDeleteButton","showPrintButton","showExportButton","showFiltersButton"];for(w in s){i("#"+v+s[w]).attr("checked",t.jui_datagrid("getOption",y[w]))}s=["_slider","_goto_page","_rows_per_page","_rows_info","_nav_buttons"];y=["useSlider","showGoToPage","showRowsPerPage","showRowsInfo","showNavButtons"];for(w in s){i("#"+v+s[w]).attr("checked",t.jui_datagrid("getPaginationOption",y[w]))}};var f=function(s,t){var u=i("#"+t);if(o(t,"dialog")){u.dialog("destroy")}u.dialog({autoOpen:true,width:400,height:350,position:{my:"top",at:"top",of:"#"+s},title:rsc_jui_dg.preferences,buttons:[{text:rsc_jui_dg.preferences_close,click:function(){i(this).dialog("close");i(this).dialog("destroy")}}],open:j(s)})};var a=function(v,u,s,B){var t=i("#"+v);var y=s.length;var z=p(t.jui_datagrid("getOption","datagrid_id_prefix"),v);var A=p(t.jui_datagrid("getOption","table_id_prefix"),v);var x='<table id="'+A+'">';x+="<thead>";x+='<tr id="'+A+'_tr_0">';i.each(s[0],function(C){x+="<th>"+C+"</th>"});x+="<tr>";x+="</thead>";x+="<tbody>";for(var w=0;w<y;w++){x+='<tr id="'+A+"_tr_"+s[w][B]+'">';i.each(s[w],function(C,D){x+="<td>"+D+"</td>"});x+="</tr>"}x+="<tbody>";x+="</table>";i("#"+z).html(x)};var n=function(t){var s=i("#"+t);if(s.jui_datagrid("getOption","applyUIGridStyle")){s.jui_datagrid("setGridStyle",s.jui_datagrid("getOption","tableClass"),s.jui_datagrid("getOption","trHoverClass"),s.jui_datagrid("getOption","thClass"),s.jui_datagrid("getOption","tdClass"))}};var l=function(x){var w=i("#"+x);var v=w.jui_datagrid("getOption","rowSelectionMode");var t=w.jui_datagrid("getOption","selectedTrTdClass");var z=p(w.jui_datagrid("getOption","table_id_prefix"),x);var u=i("#"+z);var s=(z+"_tr_").length;if(v=="multiple"){var y="#"+z+" tbody tr";i(y).each(function(){var B=parseInt(i(this).attr("id").substr(s));var A=i.inArray(B,w.data(k)["a_selected_ids"]);if(A>-1){i(this).children("td").addClass(t)}})}else{w.data(k)["a_selected_ids"]=[];w.data(k)["count_selected_ids"]=0;u.find("td").removeClass(t)}};var g=function(S,F){var ae=i("#"+S);var ak=p(ae.jui_datagrid("getOption","tools_id_prefix"),S);var Y=ae.jui_datagrid("getOption","toolsClass");var Z=ae.jui_datagrid("getOption","rowSelectionMode");var N=ae.jui_datagrid("getOption","tbButtonContainer");var aa=ae.jui_datagrid("getOption","showPrefButton");var R=ae.jui_datagrid("getOption","showPrefButtonText");var x=ae.jui_datagrid("getOption","tbPrefIconClass");var ab=ae.jui_datagrid("getOption","showSelectButtons");var Q=ae.jui_datagrid("getOption","showRefreshButton");var ad=ae.jui_datagrid("getOption","showRefreshButtonText");var w=ae.jui_datagrid("getOption","tbRefreshIconClass");var af=ae.jui_datagrid("getOption","showDeleteButton");var I=ae.jui_datagrid("getOption","showDeleteButtonText");var T=ae.jui_datagrid("getOption","tbDeleteIconClass");var z=ae.jui_datagrid("getOption","showPrintButton");var ag=ae.jui_datagrid("getOption","showPrintButtonText");var D=ae.jui_datagrid("getOption","tbPrintIconClass");var X=ae.jui_datagrid("getOption","showExportButton");var H=ae.jui_datagrid("getOption","showExportButtonText");var L=ae.jui_datagrid("getOption","tbExportIconClass");var C=ae.jui_datagrid("getOption","showFiltersButton");var V=ae.jui_datagrid("getOption","showFiltersButtonText");var W=ae.jui_datagrid("getOption","tbFiltersIconClass");var B="";if(aa){B+='<div class="'+N+'">';var t=ak+"_pref";B+='<button id="'+t+'">'+rsc_jui_dg.preferences+"</button>";B+="</div>"}if(F>0){if(ab&&Z=="multiple"){var ac=ak+"_drop_select";var y=ae.data(k)["count_selected_ids"];B+='<div class="'+N+'">';B+='<div id="'+ac+'">';B+='<div id="'+ac+'_launcher_container">';B+='<button id="'+ac+'_launcher">'+rsc_jui_dg.tb_selected_label+": "+y+"</button>";B+="</div>";B+='<ul id="'+ac+'_menu">';B+='<li id="'+ac+'_all_in_page"><a href="javascript:void(0);">'+rsc_jui_dg.tb_select_all_in_page+"</a></li>";B+='<li id="'+ac+'_none_in_page"><a href="javascript:void(0);">'+rsc_jui_dg.tb_select_none_in_page+"</a></li>";B+='<li id="'+ac+'_inv_in_page"><a href="javascript:void(0);">'+rsc_jui_dg.tb_select_inverse_in_page+"</a></li>";B+="<hr>";B+='<li id="'+ac+'_none"><a href="javascript:void(0);">'+rsc_jui_dg.tb_select_none+"</a></li>";B+="</ul>";B+="</div>";B+="</div>"}}if(Q){B+='<div class="'+N+'">';var al=ak+"_refresh";B+='<button id="'+al+'">'+rsc_jui_dg.tb_refresh+"</button>";B+="</div>"}if(F>0){if(af){B+='<div class="'+N+'">';var E=ak+"_delete";B+='<button id="'+E+'">'+rsc_jui_dg.tb_delete+"</button>";B+="</div>"}}if(F>0){if(z||X){B+='<div class="'+N+'">'}if(z){var J=ak+"_print";B+='<button id="'+J+'">'+rsc_jui_dg.tb_print+"</button>"}if(X){var v=ak+"_export";B+='<button id="'+v+'">'+rsc_jui_dg.tb_export+"</button>"}if(z||X){B+="</div>"}}if(C){B+='<div class="'+N+'">';var O=ak+"_filters";B+='<button id="'+O+'">'+rsc_jui_dg.tb_filters+"</button>";B+="</div>"}i("#"+ak).html(B);if(aa){i("#"+t).button({label:rsc_jui_dg.preferences,text:R,icons:{primary:x}})}if(F>0){if(ab&&Z=="multiple"){var u=i("#"+ac);var P=ac+"_launcher";var G=ac+"_launcher_container";var s=ac+"_menu";var A=ae.jui_datagrid("getOption","dropdownSelectOptions");var M=["launcher_id","launcher_container_id","menu_id","onSelect"];for(var ah in M){if(typeof(A[M[ah]])!="undefined"){delete A[M[ah]]}}var U=u.data("jui_dropdown");if(typeof(U)==="undefined"){var K=ae.jui_datagrid("getDefaults");var aj=K.dropdownSelectOptions;U=i.extend({},aj,A)}else{U=i.extend({},U,A)}var ai={launcher_id:P,launcher_container_id:G,menu_id:s};U=i.extend({},U,ai);u.jui_dropdown(U)}}if(Q){i("#"+al).button({label:rsc_jui_dg.tb_refresh,text:ad,icons:{primary:w}})}if(F>0){if(af){i("#"+E).button({label:rsc_jui_dg.tb_delete,text:I,icons:{primary:T}})}}if(F>0){if(z){i("#"+J).button({label:rsc_jui_dg.tb_print,text:ag,icons:{primary:D}})}if(X){i("#"+v).button({label:rsc_jui_dg.tb_export,text:H,icons:{primary:L}})}}if(C){i("#"+O).button({label:rsc_jui_dg.tb_filters,text:V,icons:{primary:W}})}};var d=function(A,x){var w=i("#"+A);var E=w.jui_datagrid("getOption","pageNum");var t=w.jui_datagrid("getOption","rowsPerPage");var y=w.jui_datagrid("getOption","maxRowsPerPage");var H=Math.ceil(x/t);var s=w.jui_datagrid("getOption","paginationClass");var D=p(w.jui_datagrid("getOption","pagination_id_prefix"),A);var v=i("#"+D);var z=w.jui_datagrid("getOption","paginationOptions");var I=["currentPage","rowsPerPage","totalPages","containerClass","onSetRowsPerPage","onChangePage","onDisplay"];for(var C in I){if(typeof(z[I[C]])!="undefined"){delete z[I[C]]}}var F=v.data("jui_pagination");if(typeof(F)==="undefined"){var B=w.jui_datagrid("getDefaults");var G=B.paginationOptions;F=i.extend({},G,z)}else{F=i.extend({},F,z)}var u={currentPage:E,rowsPerPage:t,totalPages:H,containerClass:s};F=i.extend({},F,u);v.jui_pagination(F)};var q=function(v){var u=i("#"+v);var t=u.jui_datagrid("getOption","datagrid_id_prefix")+v;var s=u.jui_datagrid("getOption","pagination_id_prefix")+v;i("#"+t).html(rsc_jui_dg.no_records_found);i("#"+s).hide()};i.fn.jui_datagrid=function(t){if(this.size()!=1){var s="You must use this plugin ("+c+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+s+"</span>");i.error(s)}if(r[t]){return r[t].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof t==="object"||!t){return r.init.apply(this,arguments)}else{i.error("Method "+t+" does not exist on jQuery."+c)}}}})(jQuery);