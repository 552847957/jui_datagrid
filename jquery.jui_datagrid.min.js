/**
 * jquery plugin which displays data in tabular format (datagrid)
 * Requires jquery, jquery-ui Themes CSS
 * It uses jui_pagination plugin (which requires jquery-ui)
 * Copyright 2012 Christos Pontikis http://pontikis.net
 * Project page https://github.com/pontikis/jui_datagrid
 * UPCOMING Release: 1.00 (?? Oct 2012)
 * License MIT
 * Minified using Online YUI Compressor http://www.refresh-sf.com/yui/
 */
"use strict";(function(e){var g="jui_datagrid";var b={init:function(k){var l=this;return this.each(function(){var m=l.data(g);if(typeof(m)==="undefined"){var p=l.jui_datagrid("getDefaults");m=e.extend({},p,k)}else{m=e.extend({},m,k)}l.data(g,m);var q=l.attr("id");l.unbind("onDelete").bind("onDelete",m.onDelete);l.unbind("onDisplay").bind("onDisplay",m.onDisplay);var n,t,u,r,o,s;n=c(m.header_id_prefix,q);t=c(m.datagrid_id_prefix,q);u=c(m.tools_id_prefix,q);r=c(m.pagination_id_prefix,q);o=c(m.pref_dialog_id_prefix,q);if(!l.data("initialize")){s='<div id="'+n+'">'+m.title+"</div>";s+='<div id="'+t+'"></div>';s+='<div id="'+u+'"></div>';s+='<div id="'+r+'"></div>';s+='<div id="'+o+'"></div>';l.html(s);l.data("initialize",true)}e("#"+q).removeClass().addClass(m.containerClass);var v=e("#"+n);if(typeof m.title==="undefined"){v.hide()}else{v.show();v.text(m.title);v.removeClass().addClass(m.headerClass)}e("#"+t).removeClass().addClass(m.datagridClass);e("#"+u).removeClass().addClass(m.toolsClass);e("#"+r).removeClass().addClass(m.paginationClass);e.ajax({type:"POST",url:m.ajaxFetchDataURL,data:{page_num:m.pageNum,rows_per_page:m.rowsPerPage},success:function(B){var C=e.parseJSON(B);var y=C.total_rows;var A=C.page_data;if(y==0){a(q)}else{j(q,y,A);h(q);if(m.useToolbar){i(q)}d(q,y);var w;if(m.showDeleteButton){w="#"+c(m.tools_id_prefix,q)+"_delete";l.off("click",w).on("click",w,function(){l.triggerHandler("onDelete")})}if(m.showRefreshButton){w="#"+c(m.tools_id_prefix,q)+"_refresh";l.off("click",w).on("click",w,function(){e("#"+q).jui_datagrid("refresh")})}if(m.showPrefButton){w="#"+c(m.tools_id_prefix,q)+"_pref";var x=e("#"+o);l.off("click",w).on("click",w,function(){if(typeof(x.data("dialog"))=="object"){x.dialog("destroy")}x.dialog({autoOpen:true,show:"blind",hide:"explode",width:400,height:350,position:{my:"top",at:"top",of:"#"+q},title:rsc_jui_dg.preferences,buttons:[{text:rsc_jui_dg.preferences_close,click:function(){e(this).dialog("close");e(this).dialog("destroy")}}],open:f(q)});var D=c(m.pref_tabs_id_prefix,q);e("#"+D).tabs()});var z;w="#"+o+"_slider";x.off("click",w).on("click",w,function(D){z=e(D.target).is(":checked");l.jui_datagrid({paginationOptions:{useSlider:z}})});w="#"+o+"_goto_page";x.off("click",w).on("click",w,function(D){z=e(D.target).is(":checked");l.jui_datagrid({paginationOptions:{showGoToPage:z}})});w="#"+o+"_rows_per_page";x.off("click",w).on("click",w,function(D){z=e(D.target).is(":checked");l.jui_datagrid({paginationOptions:{showRowsPerPage:z}})});w="#"+o+"_rows_info";x.off("click",w).on("click",w,function(D){z=e(D.target).is(":checked");l.jui_datagrid({paginationOptions:{showRowsInfo:z}})});w="#"+o+"_nav_buttons";x.off("click",w).on("click",w,function(D){z=e(D.target).is(":checked");l.jui_datagrid({paginationOptions:{showNavButtons:z}})})}l.triggerHandler("onDisplay")}}})})},getDefaults:function(){return{pageNum:1,rowsPerPage:10,maxRowsPerPage:100,useToolbar:true,showPrefButton:true,showSelectButtons:true,showSelectLabel:false,showRefreshButton:true,showDeleteButton:true,showPrintButton:true,showExportButton:true,showFiltersButton:true,showPrefButtonText:false,showSelectAllButtonText:false,showSelectNoneButtonText:false,showSelectInverseButtonText:false,showRefreshButtonText:false,showDeleteButtonText:true,showPrintButtonText:false,showExportButtonText:false,showFiltersButtonText:false,usePagination:true,paginationOptions:{visiblePageLinks:5,useSlider:true,showGoToPage:false,showRowsPerPage:true,showRowsInfo:true,showPreferences:false,disableSelectionNavPane:true},containerClass:"grid_container ui-state-default ui-corner-all",headerClass:"grid_geader ui-widget-header ui-corner-top",datagridClass:"grid_data",toolsClass:"grid_tools ui-state-default ui-corner-all",paginationClass:"grid_pagination",applyUIGridStyle:true,tableClass:"grid_table",trHoverClass:"ui-state-hover trhover",thClass:"ui-state-default",tdClass:"ui-widget-content",tbButtonContainer:"tbBtnContainer",tbPrefIconClass:"ui-icon-gear",tbSelectLabelClass:"selectLabelClass",tbSelectAllIconClass:"ui-icon-circle-check",tbSelectNoneIconClass:"ui-icon-circle-close",tbSelectInverseIconClass:"ui-icon-check",tbRefreshIconClass:"ui-icon-refresh",tbDeleteIconClass:"ui-icon-trash",tbPrintIconClass:"ui-icon-print",tbExportIconClass:"ui-icon-extlink",tbFiltersIconClass:"ui-icon-search",datagrid_id_prefix:"dg_",header_id_prefix:"header_",table_id_prefix:"tbl_",tools_id_prefix:"tools_",pagination_id_prefix:"pag_",pref_dialog_id_prefix:"pref_dlg_",pref_tabs_id_prefix:"pref_tabs_",onDelete:function(){},onDisplay:function(){}}},getOption:function(k){var l=this;return l.data(g)[k]},getAllOptions:function(){var k=this;return k.data(g)},setOption:function(k,n,m){var l=this;l.data(g)[k]=n;if(m){l.jui_datagrid("init")}},refresh:function(){var k=this;k.jui_datagrid()},destroy:function(){return e(this).each(function(){var m=e(this);var l=m.attr("id");var k=m.jui_datagrid("getOption","pagination_id_prefix")+l;e("#"+k).removeData();m.removeData()})},setGridStyle:function(l,m,p,k){var o=this;var n="#"+c(e(o).jui_datagrid("getOption","table_id_prefix"),o.attr("id"));e(n).removeClass().addClass(l);if(m!=""){e(n).on("mouseover mouseout","tbody tr",function(q){e(this).children().toggleClass(m,q.type=="mouseover")})}e(n).find("th").removeClass().addClass(p);e(n).find("td").removeClass().addClass(k)},getPaginationOption:function(m){var l=this.attr("id");var k=e("#"+l).jui_datagrid("getOption","pagination_id_prefix")+l;return e("#"+k).jui_pagination("getOption",m)},getAllPaginationOptions:function(){var l=this.attr("id");var k=e("#"+l).jui_datagrid("getOption","pagination_id_prefix")+l;return e("#"+k).jui_pagination("getAllOptions")}};var c=function(l,k){return l+k};var f=function(t){var n=e("#"+t);var r=n.jui_datagrid("getOption","pref_dialog_id_prefix");var p=c(r,t);r=n.jui_datagrid("getOption","pref_tabs_id_prefix");var u=c(r,t);var l;var m;var o="";o+='<div id="'+u+'">';o+="<ul>";o+='<li><a href="#'+u+'-1">'+rsc_jui_dg.pref_tab_grid+"</a></li>";o+='<li><a href="#'+u+'-2">'+rsc_jui_dg.pref_tab_tools+"</a></li>";o+='<li><a href="#'+u+'-3">'+rsc_jui_dg.pref_tab_nav+"</a></li>";o+="</ul>";o+='<div id="'+u+'-1">';o+="Under construction 1";o+="</div>";o+='<div id="'+u+'-2">';o+="Under construction 2";o+="</div>";o+='<div id="'+u+'-3">';o+='<ul style="list-style-type: none;">';l=p+"_slider";o+="<li>";o+='<input type="checkbox" id="'+l+'" /><label for="'+l+'">'+rsc_jui_pag.pref_show_slider+"</label>";o+="</li>";l=p+"_goto_page";o+="<li>";o+='<input type="checkbox" id="'+l+'" /><label for="'+l+'">'+rsc_jui_pag.pref_show_goto_page+"</label>";o+="</li>";l=p+"_rows_per_page";o+="<li>";o+='<input type="checkbox" id="'+l+'" /><label for="'+l+'">'+rsc_jui_pag.pref_show_rows_per_page+"</label>";o+="</li>";l=p+"_rows_info";o+="<li>";o+='<input type="checkbox" id="'+l+'" /><label for="'+l+'">'+rsc_jui_pag.pref_show_rows_info+"</label>";o+="</li>";l=p+"_nav_buttons";o+="<li>";o+='<input type="checkbox" id="'+l+'" /><label for="'+l+'">'+rsc_jui_pag.pref_show_nav_buttons+"</label>";o+="</li>";o+="</ul>";o+="</div>";o+="</div>";e("#"+p).html(o);var k=["_slider","_goto_page","_rows_per_page","_rows_info","_nav_buttons"];var s=["useSlider","showGoToPage","showRowsPerPage","showRowsInfo","showNavButtons"];for(var q in k){l=p+k[q];m=n.jui_datagrid("getPaginationOption",s[q]);e("#"+l).attr("checked",m)}};var j=function(n,m,k){var l=e("#"+n);var q=k.length;var r=l.jui_datagrid("getOption","datagrid_id_prefix")+n;var s=l.jui_datagrid("getOption","table_id_prefix")+n;var p='<table id="'+s+'">';p+="<thead>";p+="<tr>";e.each(k[0],function(t){p+="<th>"+t+"</th>"});p+="<tr>";p+="</thead>";p+="<tbody>";for(var o=0;o<q;o++){p+="<tr>";e.each(k[o],function(t,u){p+="<td>"+u+"</td>"});p+="</tr>"}p+="<tbody>";p+="</table>";e("#"+r).html(p)};var h=function(l){var k=e("#"+l);if(k.jui_datagrid("getOption","applyUIGridStyle")){k.jui_datagrid("setGridStyle",k.jui_datagrid("getOption","tableClass"),k.jui_datagrid("getOption","trHoverClass"),k.jui_datagrid("getOption","thClass"),k.jui_datagrid("getOption","tdClass"))}};var i=function(F){var Q=e("#"+F);var Y=c(Q.jui_datagrid("getOption","tools_id_prefix"),F);var M=Q.jui_datagrid("getOption","toolsClass");var C=Q.jui_datagrid("getOption","tbButtonContainer");var N=Q.jui_datagrid("getOption","showPrefButton");var E=Q.jui_datagrid("getOption","showPrefButtonText");var n=Q.jui_datagrid("getOption","tbPrefIconClass");var O=Q.jui_datagrid("getOption","showSelectButtons");var X=Q.jui_datagrid("getOption","showSelectLabel");var W=Q.jui_datagrid("getOption","tbSelectLabelClass");var r=Q.jui_datagrid("getOption","tbSelectAllIconClass");var R=Q.jui_datagrid("getOption","tbSelectNoneIconClass");var J=Q.jui_datagrid("getOption","tbSelectInverseIconClass");var w=Q.jui_datagrid("getOption","showSelectAllButtonText");var S=Q.jui_datagrid("getOption","showSelectNoneButtonText");var p=Q.jui_datagrid("getOption","showSelectInverseButtonText");var D=Q.jui_datagrid("getOption","showRefreshButton");var P=Q.jui_datagrid("getOption","showRefreshButtonText");var m=Q.jui_datagrid("getOption","tbRefreshIconClass");var T=Q.jui_datagrid("getOption","showDeleteButton");var z=Q.jui_datagrid("getOption","showDeleteButtonText");var H=Q.jui_datagrid("getOption","tbDeleteIconClass");var q=Q.jui_datagrid("getOption","showPrintButton");var V=Q.jui_datagrid("getOption","showPrintButtonText");var u=Q.jui_datagrid("getOption","tbPrintIconClass");var L=Q.jui_datagrid("getOption","showExportButton");var x=Q.jui_datagrid("getOption","showExportButtonText");var A=Q.jui_datagrid("getOption","tbExportIconClass");var t=Q.jui_datagrid("getOption","showFiltersButton");var I=Q.jui_datagrid("getOption","showFiltersButtonText");var K=Q.jui_datagrid("getOption","tbFiltersIconClass");var s="";if(N){s+='<div class="'+C+'">';var k=Y+"_pref";s+='<button id="'+k+'">'+rsc_jui_dg.preferences+"</button>";s+="</div>"}if(O){s+='<div class="'+C+'">';var G=Y+"_select_label";if(X){s+='<label id="'+G+'">'+rsc_jui_dg.select_label+"</label>"}var o=Y+"_select_all";s+='<button id="'+o+'">'+rsc_jui_dg.select_all+"</button>";var aa=Y+"_select_none";s+='<button id="'+aa+'">'+rsc_jui_dg.select_none+"</button>";var U=Y+"_select_inverse";s+='<button id="'+U+'">'+rsc_jui_dg.select_inverse+"</button>";s+="</div>"}if(D){s+='<div class="'+C+'">';var Z=Y+"_refresh";s+='<button id="'+Z+'">'+rsc_jui_dg.tb_refresh+"</button>";s+="</div>"}if(T){s+='<div class="'+C+'">';var v=Y+"_delete";s+='<button id="'+v+'">'+rsc_jui_dg.tb_delete+"</button>";s+="</div>"}if(q||L){s+='<div class="'+C+'">'}if(q){var y=Y+"_print";s+='<button id="'+y+'">'+rsc_jui_dg.tb_print+"</button>"}if(L){var l=Y+"_export";s+='<button id="'+l+'">'+rsc_jui_dg.tb_export+"</button>"}if(q||L){s+="</div>"}if(t){s+='<div class="'+C+'">';var B=Y+"_filters";s+='<button id="'+B+'">'+rsc_jui_dg.tb_filters+"</button>";s+="</div>"}e("#"+Y).html(s);if(N){e("#"+k).button({label:rsc_jui_dg.preferences,text:E,icons:{primary:n}})}if(O){e("#"+G).removeClass().addClass(W);e("#"+o).button({label:rsc_jui_dg.select_all,text:w,icons:{primary:r}});e("#"+aa).button({label:rsc_jui_dg.select_none,text:S,icons:{primary:R}});e("#"+U).button({label:rsc_jui_dg.select_inverse,text:p,icons:{primary:J}})}if(D){e("#"+Z).button({label:rsc_jui_dg.tb_refresh,text:P,icons:{primary:m}})}if(T){e("#"+v).button({label:rsc_jui_dg.tb_delete,text:z,icons:{primary:H}})}if(q){e("#"+y).button({label:rsc_jui_dg.tb_print,text:V,icons:{primary:u}})}if(L){e("#"+l).button({label:rsc_jui_dg.tb_export,text:x,icons:{primary:A}})}if(t){e("#"+B).button({label:rsc_jui_dg.tb_filters,text:I,icons:{primary:K}})}};var d=function(w,o){var z=e("#"+w);var u=z.jui_datagrid("getOption","pageNum");var q=z.jui_datagrid("getOption","rowsPerPage");var k=z.jui_datagrid("getOption","maxRowsPerPage");var s=Math.ceil(o/q);var m=z.jui_datagrid("getOption","paginationClass");var l=c(z.jui_datagrid("getOption","pagination_id_prefix"),w);var n=z.jui_datagrid("getOption","paginationOptions");var A=e("#"+l);var B=["currentPage","rowsPerPage","totalPages","containerClass","onSetRowsPerPage","onChangePage","onDisplay"];for(var v in B){if(typeof(n[B[v]])!="undefined"){delete n[B[v]]}}var r=A.data("jui_pagination");if(typeof(r)==="undefined"){var x=z.jui_datagrid("getDefaults");var p=x.paginationOptions;r=e.extend({},p,n)}else{r=e.extend({},r,n)}var y=r.showRowsInfo;var t={currentPage:u,rowsPerPage:q,totalPages:s,containerClass:m,onSetRowsPerPage:function(C,D){if(isNaN(D)||D<=0){z.jui_datagrid("refresh")}else{k=parseInt(k);if(k>0){if(D>k){D=k}}z.jui_datagrid({pageNum:1,rowsPerPage:D})}},onChangePage:function(D,C){z.jui_datagrid({pageNum:C})},onDisplay:function(){if(y){var C=((u-1)*q)+1;var D=Math.min(C+q-1,o);var E=C+"-"+D+" "+rsc_jui_dg.rows_info_of+" "+o+" "+rsc_jui_dg.rows_info_records;e(this).jui_pagination("setRowsInfo",E)}}};r=e.extend({},r,t);A.jui_pagination(r)};var a=function(n){var m=e("#"+n);var l=m.jui_datagrid("getOption","datagrid_id_prefix")+n;var k=m.jui_datagrid("getOption","pagination_id_prefix")+n;e("#"+l).html(rsc_jui_dg.no_records_found);e("#"+k).hide()};e.fn.jui_datagrid=function(l){if(this.size()!=1){var k="You must use this plugin ("+g+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+k+"</span>");e.error(k)}if(b[l]){return b[l].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof l==="object"||!l){return b.init.apply(this,arguments)}else{e.error("Method "+l+" does not exist on jQuery."+g)}}}})(jQuery);